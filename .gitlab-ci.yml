image: gradle:latest

before_script:
  - export GRADLE_USER_HOME=`pwd`/.gradle

stages:
  - build
  - staging
  - production

build:
  stage: build
  cache:
    key:
      files:
        - build.gradle
    paths:
      - build/
      - cache/
      - .gradle/
    policy: pull-push
  script:
    - apt-get -y update
    - wget --no-verbose -O /tmp/chrome.deb https://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-stable/google-chrome-stable_100.0.4896.60-1_amd64.deb 
    - apt install -y /tmp/chrome.deb -y
    - rm /tmp/chrome.deb
    - google-chrome --version
    - ./gradlew build -x test

# agent-tests:
#   stage: production
#   cache:
#     key:
#      files:
#        - build.gradle
#     paths:
#       - build/
#       - cache/
#       - .gradle/
#   script:
#    - gradle clean test --tests "co.com.webtest.certification.lili.runners.production.agents.AgentRunner" -Denvironment=prod -i
#   rules:
#   - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
#     when: never
#   - if: '$CI_PIPELINE_SOURCE == "push"'
#     when: never
#   - when: always
#   artifacts:
#     when: always
#     name: Serenity production enviroment report - agents
#     paths:
#      - target/site/serenity
#     expire_in: 1 week

serenity